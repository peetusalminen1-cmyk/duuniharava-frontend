<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kirjaudu | Duuniharava</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Space Grotesk', sans-serif; background-color: #0F0F0F; color: #FFFFFF; }
        .turkoosi-text { color: #00BFA6; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .gradient-bg { background: linear-gradient(90deg, #00BFA6, #FF6F3C); }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-6">
    <div class="max-w-md w-full glass p-10 rounded-[2.5rem] text-center">
        <div class="text-2xl font-bold tracking-tighter mb-8">
            <span class="turkoosi-text">DUUNI</span><span class="text-[#FF6F3C]">HARAVA</span>
        </div>
        
        <h1 class="text-2xl font-bold mb-6" id="auth-title">Kirjaudu sisään</h1>
        
        <form id="auth-form" class="space-y-4 text-left">
            <div>
                <label class="block text-xs font-bold mb-2 uppercase tracking-widest text-gray-500">Sähköposti</label>
                <input type="email" id="email" required class="w-full glass p-4 rounded-xl focus:outline-none focus:border-[#00BFA6] transition text-white">
            </div>
            <div>
                <label class="block text-xs font-bold mb-2 uppercase tracking-widest text-gray-500">Salasana</label>
                <input type="password" id="password" required class="w-full glass p-4 rounded-xl focus:outline-none focus:border-[#00BFA6] transition text-white">
            </div>
            <button type="submit" id="submit-btn" class="w-full gradient-bg text-white font-black py-4 rounded-2xl hover:scale-[1.02] transition active:scale-95">
                KIRJAUDU SISÄÄN ➔
            </button>
        </form>

        <div id="no-access-section" class="mt-6 text-sm">
            <p class="text-gray-400 mb-2">Eikö sinulla ole vielä pääsyä?</p>
            <a href="https://buy.stripe.com/esimerkki" class="text-[#00BFA6] font-bold hover:underline">Osta käyttöoikeus tästä</a>
        </div>
    </div>

    <script>
        // SUPABASE ASETUKSET
        const SUPABASE_URL = 'https://zxtnhitxachrudrcrotk.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp4dG5oaXR4YWNocnVkcmNyb3RrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIyODEwOTUsImV4cCI6MjA4Nzg1NzA5NX0.DPXJlYDI2L8oLYo6ofyPJzQDTbXAhreJx7VsqhV7VdI';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Tarkistetaan onko urlissa ?signup=true (tämä linkki annetaan vain maksaneille)
        const urlParams = new URLSearchParams(window.location.search);
        const isSignUpMode = urlParams.get('signup') === 'true';

        // Jos ollaan rekisteröitymistilassa, muutetaan tekstit
        if (isSignUpMode) {
            document.getElementById('auth-title').innerText = 'Luo tunnukset';
            document.getElementById('submit-btn').innerText = 'REKISTERÖIDY JA ALOITA ➔';
            document.getElementById('no-access-section').style.display = 'none';
        }

        const form = document.getElementById('auth-form');

        form.onsubmit = async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (isSignUpMode) {
                // REKISTERÖITYMINEN
                const { data, error } = await supabaseClient.auth.signUp({ email, password });
                
                if (error) {
                    alert("Virhe: " + error.message);
                } else {
                    // Jos sähköpostivahvistus on pois päältä Supabasessa, kirjaudutaan suoraan sisään
                    alert('Tili luotu! Tervetuloa.');
                    window.location.href = 'dashboard.html';
                }
            } else {
                // TAVALLINEN KIRJAUTUMINEN
                const { error } = await supabaseClient.auth.signInWithPassword({ email, password });
                if (error) {
                    alert("Kirjautumisvirhe: " + error.message);
                } else {
                    window.location.href = 'dashboard.html';
                }
            }
        };
    </script>
</body>
</html>
